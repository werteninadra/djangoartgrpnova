{% extends 'base.html' %}

{% block title %}Manage {{ exhibition.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'virtual_exhibitions:list' %}">Virtual Exhibitions</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'virtual_exhibitions:detail' exhibition.uuid %}">{{ exhibition.title }}</a></li>
                    <li class="breadcrumb-item active">Manage</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Manage: {{ exhibition.title }}</h1>
                <div>
                    <a href="{% url 'virtual_exhibitions:detail' exhibition.uuid %}" class="btn btn-outline-primary me-2">
                        <i class="fas fa-eye"></i> View Exhibition
                    </a>
                    <a href="{% url 'virtual_exhibitions:delete_exhibition' exhibition.uuid %}" class="btn btn-outline-danger">
                        <i class="fas fa-trash"></i> Delete Exhibition
                    </a>
                </div>
            </div>

            <!-- Current Artworks -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Current Artworks ({{ artworks|length }})</h5>
                </div>
                <div class="card-body">
                    {% if artworks %}
                        <div id="artwork-list" class="row">
                            {% for artwork in artworks %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    {% if artwork.oeuvre.image %}
                                    <img src="{{ artwork.oeuvre.image.url }}" alt="{{ artwork.oeuvre.titre }}"
                                         class="card-img-top" style="height: 200px; object-fit: cover;">
                                    {% endif %}
                                    <div class="card-body">
                                        <h6 class="card-title">{{ artwork.oeuvre.titre }}</h6>
                                        <p class="card-text small text-muted">{{ artwork.oeuvre.description|truncatechars:100 }}</p>
                                        {% if artwork.description %}
                                        <div class="alert alert-info small">
                                            <strong>Note:</strong> {{ artwork.description }}
                                        </div>
                                        {% endif %}
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Order: {{ artwork.order }}</small>
                                            <form method="post" class="d-inline" onsubmit="return confirm('Remove this artwork from the exhibition?')">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="remove_artwork">
                                                <input type="hidden" name="artwork_id" value="{{ artwork.id }}">
                                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                                    <i class="fas fa-times"></i> Remove
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-images fa-2x text-muted mb-2"></i>
                            <p class="text-muted">No artworks added yet. Add some from the list below.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Add Artworks -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Add Artworks</h5>
                </div>
                <div class="card-body">
                    {% if available_artworks %}
                        <div class="row">
                            {% for oeuvre in available_artworks %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    {% if oeuvre.image %}
                                    <img src="{{ oeuvre.image.url }}" alt="{{ oeuvre.titre }}"
                                         class="card-img-top" style="height: 150px; object-fit: cover;">
                                    {% endif %}
                                    <div class="card-body">
                                        <h6 class="card-title">{{ oeuvre.titre }}</h6>
                                        <p class="card-text small text-muted">{{ oeuvre.description|truncatechars:80 }}</p>
                                        <form method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="action" value="add_artwork">
                                            <input type="hidden" name="oeuvre_id" value="{{ oeuvre.id }}">
                                            <div class="mb-2">
                                                <textarea name="description" class="form-control form-control-sm"
                                                          rows="2" placeholder="Curator's note (optional)"></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-sm w-100">
                                                <i class="fas fa-plus"></i> Add to Exhibition
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-search fa-2x text-muted mb-2"></i>
                            <p class="text-muted">All available artworks have been added to this exhibition.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Enable drag and drop reordering if needed in the future
// For now, the order is managed by the add/remove actions
</script>
{% endblock %}